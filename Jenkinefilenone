pipeline {
    agent none
    stages {
        stage('build') {
		agent { label 'slave-child3' }
            steps {
                sh '''
                        #!/bin/bash
                git pull https://github.com/pareekshithan/github_central.git master
                if [ $? -ne 0 ];then
                git clone https://github.com/pareekshithan/github_central.git master
                fi
                cd /home/ec2-user/jenkins-none/master
                make PROJ1.exe
                if [ $? -eq 0 ];then
                echo "your build is succesful" | mail -s "build" pareekshith.a.n@gmail.com
                else
                echo "your build is unsuccesful" | mail -s "build" pareekshith.a.n@gmail.com
                fi
                '''
          }
        }
        stage('deploy') {
	  agent { label 'slave-child3' }
            steps {
                sh '''
#!/bin/bash

cp /home/ec2-user/jenkins-none/master/PROJ1.exe /home/ec2-user/
'''
            }
        }
        stage('test') {
	  agent { label 'slave-child3' }
            steps {
                sh '''
#!/bin/bash
rm -rf PROJ1.exe *.o
./build1.sh
if [ $? -eq 0 ];then
echo "testing" | mail -s "test" pareekshith.a.n@gmail.com
fi
'''
           }
        }
    }
}


